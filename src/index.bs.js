// Generated by BUCKLESCRIPT VERSION 5.0.4, PLEASE EDIT WITH CARE
'use strict';

var List = require("bs-platform/lib/js/list.js");
var $$Array = require("bs-platform/lib/js/array.js");
var Block = require("bs-platform/lib/js/block.js");
var Curry = require("bs-platform/lib/js/curry.js");
var Types = require("./types.bs.js");
var React = require("react");
var Bigint = require("bs-zarith/src/Bigint.js");
var Lexing = require("bs-platform/lib/js/lexing.js");
var Printf = require("bs-platform/lib/js/printf.js");
var Parsing = require("bs-platform/lib/js/parsing.js");
var LexerUtil = require("./lexerUtil.bs.js");
var TermLexer = require("./termLexer.bs.js");
var ReactDOMRe = require("reason-react/src/ReactDOMRe.js");
var TermParser = require("./termParser.bs.js");
var LvcaMode = require("./lvca-mode");
var LanguageLexer = require("./languageLexer.bs.js");
var LanguageParser = require("./languageParser.bs.js");
var LanguageSimple = require("./languageSimple.bs.js");
var ReactCodemirror = require("react-codemirror");
var Caml_js_exceptions = require("bs-platform/lib/js/caml_js_exceptions.js");

var CodeMirror = /* module */[];

function Index$Repl(Props) {
  var input = Props.input;
  var setInput = Props.setInput;
  var options = {
    mode: "lvca"
  };
  return React.createElement(ReactCodemirror, {
              value: input,
              onChange: setInput,
              options: options
            });
}

var Repl = /* module */[/* make */Index$Repl];

function show_term(term) {
  switch (term.tag | 0) {
    case 0 : 
        return Block.spliceApply(React.createElement, [
                    "span",
                    { },
                    $$Array.concat(/* :: */[
                          /* array */[term[0]],
                          /* :: */[
                            /* array */["("],
                            /* :: */[
                              $$Array.of_list(Types.intersperse(List.map(show_scope, term[1]), ";")),
                              /* :: */[
                                /* array */[")"],
                                /* [] */0
                              ]
                            ]
                          ]
                        ])
                  ]);
    case 1 : 
        return term[0];
    case 2 : 
        return Block.spliceApply(React.createElement, [
                    "span",
                    { },
                    $$Array.concat(/* :: */[
                          /* array */["["],
                          /* :: */[
                            $$Array.of_list(List.map(show_term, term[0])),
                            /* :: */[
                              /* array */["]"],
                              /* [] */0
                            ]
                          ]
                        ])
                  ]);
    case 3 : 
        return show_prim(term[0]);
    
  }
}

function show_scope(scope) {
  return Block.spliceApply(React.createElement, [
              "span",
              { },
              $$Array.concat(/* :: */[
                    $$Array.of_list(Types.intersperse_after(List.map((function (prim) {
                                    return prim;
                                  }), scope[0]), ".")),
                    /* :: */[
                      /* array */[show_term(scope[1])],
                      /* [] */0
                    ]
                  ])
            ]);
}

function show_prim(prim) {
  switch (prim.tag | 0) {
    case 0 : 
        return Bigint.to_string(prim[0]);
    case 1 : 
        return "\"" + (prim[0] + "\"");
    case 2 : 
        if (prim[0]) {
          return "true";
        } else {
          return "false";
        }
    
  }
}

function Index$TermViewer(Props) {
  var term = Props.term;
  return React.createElement("div", undefined, show_term(term));
}

var TermViewer = /* module */[
  /* show_term */show_term,
  /* show_scope */show_scope,
  /* show_prim */show_prim,
  /* make */Index$TermViewer
];

function Index$LvcaViewer(Props) {
  var match = React.useState((function () {
          return "foo()";
        }));
  var setTermInput = match[1];
  var termInput = match[0];
  var match$1 = React.useState((function () {
          return LanguageSimple.abstractSyntax;
        }));
  var setAsInput = match$1[1];
  var asInput = match$1[0];
  var match$2 = React.useState((function () {
          return LanguageSimple.statics;
        }));
  var setStaticsInput = match$2[1];
  var match$3 = React.useState((function () {
          return LanguageSimple.dynamics;
        }));
  var setDynamicsInput = match$3[1];
  var languageLexbuf = Lexing.from_string(asInput);
  var languageResult;
  var exit = 0;
  var language;
  try {
    language = LanguageParser.languageDef(LanguageLexer.read, languageLexbuf);
    exit = 1;
  }
  catch (raw_exn){
    var exn = Caml_js_exceptions.internalToOCamlException(raw_exn);
    if (exn[0] === LexerUtil.$$SyntaxError) {
      languageResult = /* Error */Block.__(1, [exn[1]]);
    } else {
      var pos = languageLexbuf[/* lex_curr_p */11];
      var tok = Lexing.lexeme(languageLexbuf);
      languageResult = /* Error */Block.__(1, [Curry._4(Printf.sprintf(/* Format */[
                    /* String_literal */Block.__(11, [
                        "Parse error (",
                        /* String */Block.__(2, [
                            /* No_padding */0,
                            /* String_literal */Block.__(11, [
                                ") ",
                                /* String */Block.__(2, [
                                    /* No_padding */0,
                                    /* Char_literal */Block.__(12, [
                                        /* ":" */58,
                                        /* Int */Block.__(4, [
                                            /* Int_d */0,
                                            /* No_padding */0,
                                            /* No_precision */0,
                                            /* Char_literal */Block.__(12, [
                                                /* ":" */58,
                                                /* Int */Block.__(4, [
                                                    /* Int_d */0,
                                                    /* No_padding */0,
                                                    /* No_precision */0,
                                                    /* End_of_format */0
                                                  ])
                                              ])
                                          ])
                                      ])
                                  ])
                              ])
                          ])
                      ]),
                    "Parse error (%s) %s:%d:%d"
                  ]), tok, pos[/* pos_fname */0], pos[/* pos_lnum */1], (pos[/* pos_cnum */3] - pos[/* pos_bol */2] | 0) + 1 | 0)]);
    }
  }
  if (exit === 1) {
    languageResult = /* Ok */Block.__(0, [language]);
  }
  var languageView;
  languageView = languageResult.tag ? React.createElement("span", {
          className: "result-bad"
        }, languageResult[0]) : React.createElement("span", {
          className: "result-good"
        }, "(good)");
  var termResult;
  var exit$1 = 0;
  var term;
  try {
    term = TermParser.term(TermLexer.read, Lexing.from_string(termInput));
    exit$1 = 1;
  }
  catch (raw_exn$1){
    var exn$1 = Caml_js_exceptions.internalToOCamlException(raw_exn$1);
    if (exn$1[0] === LexerUtil.$$SyntaxError) {
      termResult = /* Error */Block.__(1, [exn$1[1]]);
    } else if (exn$1 === Parsing.Parse_error || exn$1 === TermParser.$$Error) {
      termResult = /* Error */Block.__(1, ["Parse error"]);
    } else {
      throw exn$1;
    }
  }
  if (exit$1 === 1) {
    termResult = /* Ok */Block.__(0, [term]);
  }
  var termView;
  termView = termResult.tag ? React.createElement("div", {
          className: "error"
        }, termResult[0]) : React.createElement(Index$TermViewer, {
          term: termResult[0]
        });
  return React.createElement("div", {
              className: "lvca-viewer"
            }, React.createElement("h1", {
                  className: "header"
                }, "LVCA"), React.createElement("h2", {
                  className: "header2 header2-abstract-syntax"
                }, "Abstract Syntax ", languageView), React.createElement("div", {
                  className: "abstract-syntax-pane"
                }, React.createElement(ReactCodemirror, {
                      value: asInput,
                      onChange: (function (str) {
                          return Curry._1(setAsInput, (function (param) {
                                        return str;
                                      }));
                        }),
                      options: {
                        mode: "default"
                      }
                    })), React.createElement("h2", {
                  className: "header2 header2-statics"
                }, "Statics"), React.createElement("div", {
                  className: "statics-pane"
                }, React.createElement(ReactCodemirror, {
                      value: match$2[0],
                      onChange: (function (str) {
                          return Curry._1(setStaticsInput, (function (param) {
                                        return str;
                                      }));
                        }),
                      options: {
                        mode: "default"
                      }
                    })), React.createElement("h2", {
                  className: "header2 header2-dynamics"
                }, "Dynamics"), React.createElement("div", {
                  className: "dynamics-pane"
                }, React.createElement(ReactCodemirror, {
                      value: match$3[0],
                      onChange: (function (str) {
                          return Curry._1(setDynamicsInput, (function (param) {
                                        return str;
                                      }));
                        }),
                      options: {
                        mode: "default"
                      }
                    })), React.createElement("h2", {
                  className: "header2 header2-repl"
                }, "repl"), React.createElement("div", {
                  className: "repl-pane"
                }, React.createElement(Index$Repl, {
                      input: termInput,
                      setInput: (function (str) {
                          return Curry._1(setTermInput, (function (param) {
                                        return str;
                                      }));
                        })
                    }), React.createElement("div", {
                      className: "term-view"
                    }, termView)));
}

var LvcaViewer = /* module */[/* make */Index$LvcaViewer];

ReactDOMRe.renderToElementWithId(React.createElement(Index$LvcaViewer, { }), "index");

var _modeImport = /* () */0;

exports._modeImport = _modeImport;
exports.CodeMirror = CodeMirror;
exports.Repl = Repl;
exports.TermViewer = TermViewer;
exports.LvcaViewer = LvcaViewer;
/*  Not a pure module */

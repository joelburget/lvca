// Generated by BUCKLESCRIPT VERSION 5.0.4, PLEASE EDIT WITH CARE
'use strict';

var List = require("bs-platform/lib/js/list.js");
var $$Array = require("bs-platform/lib/js/array.js");
var Block = require("bs-platform/lib/js/block.js");
var Curry = require("bs-platform/lib/js/curry.js");
var Types = require("./types.bs.js");
var React = require("react");
var Bigint = require("bs-zarith/src/Bigint.js");
var Lexing = require("bs-platform/lib/js/lexing.js");
var LexerUtil = require("./lexerUtil.bs.js");
var TermLexer = require("./termLexer.bs.js");
var ReactDOMRe = require("reason-react/src/ReactDOMRe.js");
var TermParser = require("./termParser.bs.js");
var LvcaMode = require("./lvca-mode");
var LanguageSimple = require("./languageSimple.bs.js");
var ReactCodemirror = require("react-codemirror");
var Caml_js_exceptions = require("bs-platform/lib/js/caml_js_exceptions.js");

var CodeMirror = /* module */[];

function Index$Repl(Props) {
  var input = Props.input;
  var setInput = Props.setInput;
  var options = {
    mode: "lvca"
  };
  return React.createElement(ReactCodemirror, {
              value: input,
              onChange: setInput,
              options: options
            });
}

var Repl = /* module */[/* make */Index$Repl];

function show_term(term) {
  switch (term.tag | 0) {
    case 0 : 
        return Block.spliceApply(React.createElement, [
                    "span",
                    { },
                    $$Array.concat(/* :: */[
                          /* array */[term[0]],
                          /* :: */[
                            /* array */["("],
                            /* :: */[
                              $$Array.of_list(Types.intersperse(List.map(show_scope, term[1]), ";")),
                              /* :: */[
                                /* array */[")"],
                                /* [] */0
                              ]
                            ]
                          ]
                        ])
                  ]);
    case 1 : 
        return term[0];
    case 2 : 
        return Block.spliceApply(React.createElement, [
                    "span",
                    { },
                    $$Array.concat(/* :: */[
                          /* array */["["],
                          /* :: */[
                            $$Array.of_list(List.map(show_term, term[0])),
                            /* :: */[
                              /* array */["]"],
                              /* [] */0
                            ]
                          ]
                        ])
                  ]);
    case 3 : 
        return show_prim(term[0]);
    
  }
}

function show_scope(scope) {
  return Block.spliceApply(React.createElement, [
              "span",
              { },
              $$Array.concat(/* :: */[
                    $$Array.of_list(Types.intersperse_after(List.map((function (prim) {
                                    return prim;
                                  }), scope[0]), ".")),
                    /* :: */[
                      /* array */[show_term(scope[1])],
                      /* [] */0
                    ]
                  ])
            ]);
}

function show_prim(prim) {
  switch (prim.tag | 0) {
    case 0 : 
        return Bigint.to_string(prim[0]);
    case 1 : 
        return "\"" + (prim[0] + "\"");
    case 2 : 
        if (prim[0]) {
          return "true";
        } else {
          return "false";
        }
    
  }
}

function Index$TermViewer(Props) {
  var term = Props.term;
  return React.createElement("div", undefined, show_term(term));
}

var TermViewer = /* module */[
  /* show_term */show_term,
  /* show_scope */show_scope,
  /* show_prim */show_prim,
  /* make */Index$TermViewer
];

function Index$LvcaViewer(Props) {
  var match = React.useState((function () {
          return "foo()";
        }));
  var setTermInput = match[1];
  var termInput = match[0];
  var match$1 = React.useState((function () {
          return LanguageSimple.str;
        }));
  var setLanguageDefinition = match$1[1];
  var termResult;
  var exit = 0;
  var term;
  try {
    term = TermParser.term(TermLexer.read, Lexing.from_string(termInput));
    exit = 1;
  }
  catch (raw_exn){
    var exn = Caml_js_exceptions.internalToOCamlException(raw_exn);
    termResult = exn[0] === LexerUtil.$$SyntaxError ? /* Error */Block.__(1, [exn[1]]) : /* Error */Block.__(1, ["Parse error"]);
  }
  if (exit === 1) {
    termResult = /* Ok */Block.__(0, [term]);
  }
  var termView;
  termView = termResult.tag ? React.createElement("div", {
          className: "error"
        }, termResult[0]) : React.createElement(Index$TermViewer, {
          term: termResult[0]
        });
  return React.createElement("div", {
              className: "lvca-viewer"
            }, React.createElement("h1", {
                  className: "header"
                }, "LVCA"), React.createElement("h2", {
                  className: "header2 header2-left"
                }, "Language Definition"), React.createElement("div", {
                  className: "left-pane"
                }, React.createElement(ReactCodemirror, {
                      value: match$1[0],
                      onChange: (function (str) {
                          return Curry._1(setLanguageDefinition, (function (param) {
                                        return str;
                                      }));
                        }),
                      options: { }
                    })), React.createElement("h2", {
                  className: "header2 header2-right"
                }, "repl"), React.createElement("div", {
                  className: "right-pane"
                }, React.createElement(Index$Repl, {
                      input: termInput,
                      setInput: (function (str) {
                          return Curry._1(setTermInput, (function (param) {
                                        return str;
                                      }));
                        })
                    }), termView));
}

var LvcaViewer = /* module */[/* make */Index$LvcaViewer];

ReactDOMRe.renderToElementWithId(React.createElement(Index$LvcaViewer, { }), "index");

var _modeImport = /* () */0;

exports._modeImport = _modeImport;
exports.CodeMirror = CodeMirror;
exports.Repl = Repl;
exports.TermViewer = TermViewer;
exports.LvcaViewer = LvcaViewer;
/*  Not a pure module */
